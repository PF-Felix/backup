# 负载均衡算法

==随机==

==轮询（Round Robin）==

==加权轮询（Weight Round Robin）==

服务器硬件配置不同的情况下使用，通过概率实现权重不同
比如【1-10】取随机数，如果取到【1-6】就找6权重的服务

==散列取模==

可以将请求的 IP 地址转化为散列值，与服务器数量取模，选择特定的服务器，此算法绑定请求者的 IP 与服务器

==最少链接==

记录每个服务器正在请求的链接数，将请求分发到链接数量最少的服务器

# 限流算法

## 固定时间窗口算法

在指定的时间周期内，访问次数达到阈值时触发限流策略
下一个时间周期进行访问时，访问次数清零

【缺点】是有一个临界值问题

举例说明临界值问题：

假设阈值是100

- 1.00-2.00 是一个时间周期，周期内访问次数没有超过阈值，后半小时访问次数是60
- 2.00-3.00 是一个时间周期，周期内访问次数没有超过阈值，前半小时访问次数是60
- 那么 1.30-2.30 这个时间周期内访问次数是 120 已经超过阈值了，但是不会触发限流策略

## 滑动时间窗口算法

滑动时间窗口是将时间周期切分为多个小的时间窗口，分别计算每个小窗口中的访问次数，最终统计求和

能很好地解决临界值问题

小窗口划分越多，限流的统计就会越精确

## 漏桶算法

漏桶算法的特点：

- 漏桶具有固定容量，固定的流出速率（流出请求）
- 入口流量可以以任意速率流入（流入请求）
- 如果入口流量超出了桶的容量，则流入流量会溢出（新请求被拒绝）

优点：突发请求时丢弃的请求较少
缺点：无法精确控制流出速度；无法调整桶的大小

可以用于瞬时高并发流量，比如**秒杀**

## 令牌桶算法

令牌桶算法的特点：

- 桶中存放的是令牌而不是流量，令牌桶满了令牌被丢弃
- 每当一个请求过来时，就会尝试从桶里移除一个令牌，如果没有令牌的话，请求无法通过

优点：令牌桶算法可以通过控制令牌的放入速度动态调整请求的处理速度
缺点：突发请求时如果令牌的放入速度调整不及时，可能会丢弃很多请求

可以用来控制自己的处理速度，防止突发请求导致自己过载
也可以用来控制自己请求第三方服务的速度，防止把下游压垮
