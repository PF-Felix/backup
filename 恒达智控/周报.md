# 10月27日

**本周内容**

- 统一权限用户同步到IOT方案制定`王龙浩正在开发中，计划下周五提测`
- 受用户同步方案影响，修改相关的代码不影响现有业务，并且去掉用户和用户单元的注册、新增、编辑、删除功能~~已提测~~
- 处理或解决bug
  - 2006 【正式环境】有报警数据时，监控视图界面不显示报警弹窗~~排查问题原因，前端请求地址不正确，张涛已解决，下次上线解决~~
  - 2005 【正式环境】参数管理界面，直接点击搜索按钮，页面提示服务器内部错误~~数据问题，已修复~~
  - 2004 【正式环境】报警规则联系人，只能选择单元管理员，不能选择用户，需要能全部选择~~已提测~~
  - 2003 【正式环境】从统一权限同步用户到湍流平台时，需要添加单元做判断，不同单元，用户名想通的账号不能被覆盖掉用户~~不予解决~~
  - 2002 【正式环境】报警规则联系人应该不显示删除的用户`排查问题原因，交给张涛解决`
  - 1992 【正式环境】在安全管理界面，弹窗显示一个未知错误~~未再复现~~
  - 1949 不同单元登录名重复新增失败【同单元需要做重复限制】~~不予解决~~
  - 协助张涛修改bug，websocket报警加上 AlarmName~~已提测~~

**下周计划**

- 统一权限用户同步到IOT的自测和提测
- 处理和解决bug
  - 1998 单元管理员，要有：服务适配器、模式管理、指标管理、采集管理等模块的操作权限
  - 1951 物模型关联报警规则时，下拉列表空，无法选取以已创建的报警规则
  - 1900 视图有报警推送，报警历史和首页报警关注显示空
  - 1878 指标管理添加，物模型搜索框和物模型字段
  - 1802 统一权限的用户直接登陆湍流平台，应提示账户不存在，而不是被禁用
  - 2013 用adnmin账户查看视图详情界面，不显示设备名称，会报错
  - 1978 账户套餐功能失效，A单元未购买账户套餐，但该单元所有用户都未被禁用，还可以正常登录
  - 1802 统一权限的用户直接登陆湍流平台，应提示账户不存在，而不是被禁用
  - 1801 设备关联采集模式时，需要判断采集模式是否关联了采集指标
  - 1480 用户购买账户套餐赠送了1个节点，又购买了5个节点套餐，共6个节点套餐，关联6个节点时无法保存，提示超出套餐数量
  - 2019 设备关联的采集模式，可以取消不关联，并更新到redis中
  - 2018 先关联节点，在关联采集，不会更新到redis中，需要修改，如果先关联节点，在关联采集，需要更新到redis中
  - 2017 物模型告警信息查询错误，查询出其他物模型中的告警（查询语句有问题）

# 10月20日

**本周内容**

- Gitlab 无法登录问题解决
- 协助张涛测试定时WebSocket报警
- 修复报警历史显示数据（已提测）
- 修复监控视图24小时健康状态显示（已提测）
- 修复监控视图中采集数据无数据的问题（已提测）
- 修复监控视图中报警数据无数据的问题（已提测）
- 修复bug：（已提测）
  - 1918 视图中有报警信息在推送，但报警查询显示空
  - 1997 设备未关联采集，要求可以关联节点（现在未关联采集是不能关联节点的）
  - 修复LambdaUpdateChainWrapper.update无法更新updateTime字段的问题
  - 1996 设备修改、关联物模型、采集、节点等，要求不改变排序，只有新增时倒序排序就行
  - 1798 8单元监控视图显示无数据，influxdb数据库中是有数据的
  - 1553 16-1节点采集数据(采集的数据时间和圆点对应不上)
  - 1557 筛选出的数据和筛选时间对应不上
  - 1551 告警记录，筛选条件(故障)需要确认功能是否正确，是否有故障数据就能正确显示

**下周计划**

- 解决禅道上的bug
  - 2006 【正式环境】有报警数据时，监控视图界面不显示报警弹窗
  - 2005 【正式环境】参数管理界面，直接点击搜索按钮，页面提示服务器内部错误
  - 2004【正式环境】报警规则联系人，只能选择单元管理员，不能选择用户，需要能全部选择
  - 2003 【正式环境】从统一权限同步用户到湍流平台时，需要添加单元做判断，不同单元，用户名想通的账号不能被覆盖掉
  - 2002 【正式环境】报警规则联系人应该不显示删除的用户
  - 1998 单元管理员，要有：服务适配器、模式管理、指标管理、采集管理等模块的操作权限（现在是没有的，无法创建采集指标等一系列操作）
  - 1992 【正式环境】在安全管理界面，弹窗显示一个未知错误
  - 1951 物模型关联报警规则时，下拉列表空，无法选取以已创建的报警规则
  - 1949 不同单元登录名重复新增失败【同单元需要做重复限制】
  - 1900 视图有报警推送，报警历史和首页报警关注显示空
  - 1878 指标管理添加，物模型搜索框和物模型字段
  - 1802 统一权限的用户直接登陆湍流平台，应提示账户不存在，而不是被禁用

# 9月29日

**本周内容**

- 下面各项内容提测
  - 数采核查功能
  - 脚本生成器功能
  - 飞书报警信息格式化
  - 飞书报警按报警类型区分推送给用户和运维
- 解决了一些bug
- 协助陈立会测试

**下周内容**

- 生产环境部署
- 报警历史改造
- 监控视图：采集数据和报警数据展示

# 9月22日

**本周内容**

- 软著材料修改提交
- 面试4人，陈鹏安排3人 王智安排1人
- 采集核查开发完成并自测
  - 功能无问题
  - 统计数据不准确，已经反馈给李亚会
- 排查和解决禅道的bug
  - 1879 设备新增时，要求设备id可修改
  - 1889 redis中数据的key应该换成code的值
  - 1951 物模型关联报警规则时...
  - 1768 指标管理新增时，添加个字段为：指标标识符，必填
  - 1766 登录成功后页面提示数据库错误
- 删除无用代码
- ~~因采集核查数据不准本周无法提测~~

**下周计划**

- 采集核查功能提测
- 脚本编辑器进度跟进
- 报警历史
  - 需求变动确认
  - influxdb 数据规范制定
  - 开发自测提测
- mainflux 学习研究

# 9月15日

**本周内容**

- 转正申请书提交
- 软著材料提交
- 脚本编辑器进度跟进*等张涛开发完成*
- 采集核查**开发中**
  - mainflux的信息：和王智确认，本次需求先去掉 mainflux 的相关信息，先把 mainflux 研究一下再做考虑
  - influxdb：存储方案输出，已经和李亚会沟通过，等她改过才能自测并提测
  - influxdb：研究 influxdb 的安装和使用、关键概念、数据读写最佳实践、存储引擎内部工作原理等
- 总结报警历史需求存在的问题

**下周计划**

- 完成采集核查的功能并提测
- 报警历史需求再次确认，修改代码并提测
- mainflux
  - 和王智讨论为什么要用 mainflux（个人感觉 mainflux 增加了开发难度，而且特殊需求下是满足不了需求的）
  - 如果确实有必要用，再深入研究下吧，避免踩坑
- 脚本编辑器进度跟进

# 9月10日

**本周内容**

- 脚本编辑器管理~~前端尚未开发完成~~
  - 新增、更新、删除、分页
  - 开发与自测
- 飞书接入，采集报警`已经提测`
  - 包括监控视图告警代码重构，删除无用代码
  - 熟悉了 rabbitmq 消费的相关代码
- 删除无用代码，字典表相关
- 采集核查相关
  - 采集日志、解析日志、推送日志的数据统计都开发完毕
  - influxdb 的数据统计~~尚未完成~~
    - 旧的存储方案不合适，会出现查不到准确的数据，已经和王智 李亚会 沟通过 插入数据不要使用默认生成的时间戳改为把 gentime 当作时间戳存储
    - ❤️遇到尚未解决的问题是查询耗时过长无法统计到数据，经过几天的研究（看官方文档和自测）认为是旧的数据存储方式的设计有问题，有想到新方案并自测能够很快查询到结果，需要下周李亚会配合改下数据测试下，另外就是这个方案下周需要和 王智 李亚会 沟通确定最终方案

**下周计划**

- 转正申请书提交
- 软著材料编写
- 脚本编辑器进度跟进
- 持续监控测试环境，再出现堆内存溢出就把日志拿出来看看，上周没复现问题
- 完成采集核查的功能并提测
- 解决禅道bug

# 9月1日

**本周内容**

- 上周开发的内容提测，涉及下面
  - 解决 Redis 数据不一致的问题
  - Redis 数据库双写一致性改造
  - 报警历史接口改造
- 采集核查开发自测，进展如下*未完成，需采集数据*
  - 数据统计任务：采集日志能统计到，解析和推送数据因日志文件过大统计不到，influx / mainflux 数据因数据不完整缺采集类型无法统计
  - 前后端接口：也是采集日志相关可以，别的日志和数据就无法开发自测

**下周计划**

- 完成采集核查的功能，需要李亚会和袁云龙的数据支撑，否则无法自测
- 飞书接入，暂定接入到监控视图的告警
- 脚本编辑器管理
- 持续监控测试环境，再出现堆内存溢出就把日志拿出来看看
- 解决禅道bug
- 熟悉一个模块

# 8月25日

**本周内容**

- 提交测试版本，重点涉及
  - 文件管理
  - 激光雕刻机打标
  - 报警历史
- 配合宗瞳的激光打标的紧急测试，花费一天时间
- 采集核查
  - 需求讨论
  - 采集、解析、推送、存入DB等日志规范制定并输出文档
  - 采集核查接口设计并和前端对接
  - 业务功能的开发（开发中，未完成，预计本月底or9月初提测）
- 解决袁工 艮鹏提到的 redis 数据不一致问题，出现两次，手动修改 Redis 数据解决
- 从根本上解决 Redis 数据不一致的问题
  - 之前因紧急需求只改了 Redis 数据，导致了相关业务操作会数据不一致
  - 现在改了代码能够做到解决这个问题了（下周一提测）
- Redis 数据库双写一致性
  - 方案确定并输出文档
  - 代码改造完成（下周一提测）
- 报警历史接口改造，改造了报警标准输出参数（下周一提测）
- 周五参与代码评审

**下周计划**

- 提交测试版本，重点涉及：
  - 解决 Redis 数据不一致的问题
  - Redis 数据库双写一致性改造
  - 报警历史接口改造
- 采集核查功能开发自测完成
- 着手解决测试环境堆内存溢出的问题，不容易排查
- 推进生产环境的更新，保持和测试环境一致
- 解决禅道上的bug

# 8月18日

**本周内容**

- 脚本编辑器需求理解和讨论，后续会做 @王智 @张涛 @陈立会
- 采集核查需求理解和讨论，下周开始做（计划两周完成）
- Redis数据改造支持，暂时修改测试环境的Redis数据结构，保障数据能用
- 后续有时间再改代码，列入计划
- 文件管理相关功能，开发和自测（计划下周一提测）
- 激光雕刻机相关
  - 需求讨论会议 @王智 @王艮鹏 @宗瞳
  - 打印等功能的开发、自测、联调 @袁云龙 @庞静超
  - 计划下周提测一版
- 解决bug，周一提测后可以测试
  - 1897 删除指标，页面提示数据库错误
  - 1898 两个物模型，属性字段相同，只能新增一个，新增第二个页面提示重复…

**下周计划**

- 文件管理提测
- 激光雕刻机打印提测
- 报警历史开发、自测完毕
- 开始做采集核查的功能
- 解决禅道紧急的bug

# 8月13日

**本周内容**

- 文件上传接口设计和开发：后续凡是上传文件到云服务器，都是走这个接口拿到链接
- 激光雕刻机打印接口设计和接口文档提供 @王智 @王艮鹏
- 发现并支持解决 maven 仓库下载新包还是走旧地址的问题，耽误了几个小时，@王博 支持排查问题，最后 @郑智 修复
- 端设备支持影子设备，相关接口的开发，下面也有提到
- 代码重构和优化，具体涉及下面的点：
  - 支持添加影子设备
  - 添加设备：加入一个新属性，即设备ID
  - 添加设备：必须保证数据唯一性，即同一用户单元下设备名称不能重复、同一用户单元下设备ID不能重复，旧代码只是代码层面查询有没有做判断，优化方案是数据库增加唯一索引做兜底，真正保证数据唯一性
  - 添加影子设备：必须保证同一用户单元下设备名称不能重复，解决方案与添加设备相同；设备ID的唯一性解决方案是插入一个无用的纳秒时间戳来满足唯一性，这个数据无用，影子设备真正用的是其父设备的设备ID
  - 删除设备 & 添加影子设备：并发情况下可能出现的数据问题，父设备删除成功但是影子设备添加成功后是未删除状态，解决方案是这两个功能针对同一个父设备加分布式锁
  - 删除设备 & 删除影子设备：第一次删除可以成功，第二次返回删除失败的提示
  - 修改设备信息：目前的更新信息不涉及关键信息，因此不更新Redis
  - 修改设备信息：修改已经删除的设备会报错给出提示
  - 查询设备详情：不再支持已经删除的设备，旧功能是只要传了设备ID就能查到信息
  - 设备关联节点 & 设备和节点解除关联：支持影子设备
  - 设备关联节点 & 设备和节点解除关联：代码逻辑是先更新数据库再更新Redis，旧代码在并发情况下可能出现数据不一致的情况，解决办法是改造更新数据库的      SQL，保证对于同一条记录的并发更新最多只能有一个成功
  - 以上相关的所有查询功能，能利用索引的增加索引加快查询速度
- 以上所有功能的自测 + 提测

**下周计划**

- 文件管理相关功能的开发，计划周五或周六提测
- 处理积累的bug
- 原本计划中的报警历史没有提测，延迟到下周

# 8月6日

**本周内容**

- 解决一些bug并提测（8月2日），详细如下：
  - 1776 设备关联节点提示服务器错误（因：该设备关联的采集模式，未关联指标）
  - 1779 从门户登录湍流平台，页面报错，跳转失败
  - 1479 redis数据库中的物模型以及采集指标需要优化
  - 1038 报警规则更新后，物模型需要重新关联一次，不重新关联，不会更新
  - 1774 删除发布主题，页面提示服务器内部错误
- 和王智、陈立会、李亚会讨论紧急修改指标管理相关的需求、开发、自测、提测（8月5日已提测）
- 和王智、陈立会讨论影子设备的需求并开始开发（刚开始做）
- 做相关需求时，发现指标管理相关代码有很多问题，做了重构和优化，重构就不说了，优化的重点如下：
- 新增&更新指标：老代码只在代码层面判断有没有重复，没有考虑到并发情况下会出现的问题；解决方案是在数据库中加了唯一索引来兜底，保证数据的唯一性
- 逻辑删除改造：加唯一索引后逻辑删除可能因为数据重复删不掉，解决方案是把 is_deleted 字段更新为当前记录的 id
- PS：以上优化只涉及到指标管理相关，其他模块也存在类似问题，后续有时间再优化

**下周计划**

- 影子设备功能的开发并提测
- 继续处理禅道累积的bug
- 报警历史先支持 FluxDB 并提测

# 7月30日

**本周内容**

- Redis数据结构的改造：开发、自测完成、已经发布测试（7月26日）
- 7月26日提测
- 解决一系列bug，有的是本次提测后不再出现的，有的不是bug和测试沟通解决的，有的是下次提测修复的
  - 1470 生成的发布主题无法删除
  - 1530 采集管理ocr模式关联指标，服务器报错
  - 1639 从门户登录湍流平台页面报错，无法跳转
  - 1640 视图界面点击任意节点，页面报数据库错误
  - 1480 用户购买账户套餐赠送了1个节点，又购买了5个节点套餐，共6个节点套餐，关联6个节点时…
  - 1772 新增订阅主题界面，服务适配器列表显示空(已有服务适配)
  - 1766 登录成功后页面提示数据库错误
  - 1765 从湍流平台登录门户的用户，提示错误，应该提示账户不存在，账户：cehnlihui 密码…
  - 1041 节点和物模型未关联，发送该节点的数据，成功(因：多台设备关联一个节点和一个物模型…
  - 1777 通过接口，设备关联物模型，未传模型id，返回成功
- 修复测试环境依然存在的统一认证单点登录问题
- 与测试沟通产品的功能与尚存的问题

**下周计划**

- 禅道bug的解决进度，与陈立会和王智沟通
- 报警历史问题跟踪，等待有数据
- 开始做打印机设备的接入
- 优化项目已有的功能和代码

# 7月23日

**本周内容**

- 单点登录问题处理
  - IIOT平台的问题已经解决，尚未提测，计划7月26日即下周三提测
  - 发现一个偶现的bug获取不到token的问题已经反馈给了王博
- 报警历史查询与导出
  - 与前端联调完成，因暂时缺数据先不提测，待按新的标准报警参数接到数据
  - 目前只查了fluxDB，尚未支持查询mainflux，后续研究加上，作为长期计划
- Redis数据结构设计变更
  - 开发完成90%，计划7月26日即下周三提测
- 数据库Redis双写一致性问题思考并出具解决方案，已给到王智，暂时搁置，作为长期计划
- 测试环境迁移：192.168.175.204 切换到 172.30.2.69
- 整理开发文档到wiki：开发设计文档，个人周报记录等

**下周计划**

- Redis数据改造完成并提测、统一认证单点登录的提测
- 页面实操熟悉数据采集和报警的流程
- 重点解决禅道bug
- 跟踪开发环境报警数据的接入

# 7月16日

**本周内容**

- 账号申请：精益改善信息平台、禅道
- 解决禅道bug
  - 1441 创建指标后，再次打开该指，物模型字段显示为数字，应该显示选择的物模型名称
  - 1471 设备关联物模型后未自动生成发布主题
  - 1409 被引用的服务适配器可以删除
- 熟悉代码提交、提测、上线生产一条龙走通
- 结合禅道bug，理解设备关联物模型、关联节点等相关的业务逻辑
- 【项目思考】Redis 存储的数据有问题，已总结并反馈给王智；问题如下
  - 前提：key 是节点mac地址
  - 问题1：一个节点可以绑定多个设备，而数据只存储了一个设备的信息
  - 问题2：删除发布主题需要更新缓存，如果解绑了节点就找不到mac地址了无法更新缓存
- 【排查解决生产环境问题】
  - 统一认证单点登录
  - 登录报错；原因是数据库中缺失*管理员用户和其用户单元*数据，已告知测试陈立会等待测试反馈
- 报警历史查询、导出：功能设计、开发实现尚未和前端联调

**下周计划**

- 报警历史查询、导出：与前端联调
- mom系统会通过订阅的数据进行报工数据处理，所以这个一定要准确，IIOT平台需要能够完整都透传采集数据，做到中间环节不遗漏，有问题可定位
- 继续解决禅道上的bug
- 外网权限申请催促进度

# 7月9日

**本周内容**

- 办公电脑申请：笔记本+显示器
- 电脑安装常用软件
- 账号申请：gitlab、confluence、LADP、蓝湖
- 其他入职申请：内网申请、亿赛通加密申请、ERP、邮箱申请、外网权限申请
- git clone 代码测试，没问题
- 【01湍流IIOT物联网管理平台】申请这个文档的权限
- 【湍流IIOT工业物联网平台】参考张青松的交接文档，熟悉功能
- 【湍流IIOT物联网管理平台】配合郑智，修改生产环境相关域名和镜像地址

**下周计划**

- 【湍流IIOT】尽快熟悉项目
- 预留给其他计划外的事情
- 外网权限尚未开通，催促进度